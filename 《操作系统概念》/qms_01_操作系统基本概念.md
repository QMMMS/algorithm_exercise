# 操作系统基本概念

计算机软件体系结构可以简单分成为：

1. 最顶层为应用
2. 运行库
3. 操作系统
4. 最底层的是硬件

软件调用逻辑为：

1. 应用程序调用应用程序编程接口（API）。API的提供者是运行库。
2. 运行库使用操作系统提供的系统调用接口。往往以软件中断实现。
3. 操作系统内核调用硬件接口。硬件的生产厂商负责提供硬件规格、接口、驱动程序。

操作系统的基本功能：

- 管理资源（核心）
- 控制程序执行（核心）
- CPU 管理、内存管理、文件管理、设备管理、通信、使计算机系统方便易用

## 操作系统历史

- 手工操作（此阶段无操作系统）
- 批处理阶段：单道批处理系统和多道批处理系统。出发点是充分利用系统资源（CPU、内存、外设）
- 分时操作系统：将CPU的时间划分成若干个片段,称为时间片，操作系统以时间片为单位,轮流为每个终端用户服务。出发点是为用户提供与计算机系统直接交互的能力，允许许多用户共享计算机系统。
- 实时操作系统：软实时系统、硬实时系统。能对来自外部的请求和信号在限定的时间范围内做出及时响应的操作系统。
- 网络操作系统
- 分布式计算机系统
- 个人计算机操作系统

> 用户将一批作业提交给操作系统后就不再干预，由操作系统控制它们自动运行。这种采用批量处理作业技术的操作系统称为批处理操作系统。

## 系统调用与中断

系统调用提供操作系统服务接口。

调用系统调用时，通过**软件中断**陷入内核模式，执行系统调用，再回到用户模式返回。

软中断，也叫同步中断。软中断是由CPU执行中断产生指令时产生，是由程序预先实现好的，不是随机的。

硬中断，也叫异步中断。硬中断是由硬件设备依照CPU时钟信号产生的，即意味着中断发生具备随机性和突发性，可以在指令正在执行时发生。例如键盘中断。硬中断是由硬件产生的，像磁盘，网卡，键盘，时钟等。

软中断：进程 ->内核中的设备驱动程序；硬中断：硬件->CPU->内核中的设备驱动程序。

中断触发过程：

- 转移至内核态
- 保存当前指令寄存器 PC等上下文
- 加载，执行中断处理程序
- 恢复指令寄存器 PC等上下文

## 用户模式和内核模式

内核模式可以执行所有特权指令。

区分两种模式的原因是为了安全，限制应用对敏感资源的权限；应用会产生恶意指令，需要限制。

## 操作系统结构

- 单内核（宏内核）：所有 OS 功能模块均在内核态工作；（MS-DOS）没有清晰的系统模块划分；（MS-DOS）应用程序与 OS 内核之间缺少隔离保护；
- 微内核：一种极精简的 OS 内核设计， 仅将内存地址空间管理、线程调度、进程间通信纳入内核,而将文件系统等模块置入用户空间；只在内核中保留如线程调度、进程间通信等核心功能，而将其他的 OS 服务转移到用户态，以用户态模块的形式实现
- 混合内核：单内核和微内核的混合结构。
- 分层法
- 模块化

